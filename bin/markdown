#!/usr/bin/env node

var fs = require('fs'),
	program = require('commander'),
    markdown = require('github-flavored-markdown').parse;

program.version('0.0.1');
	
function countdown(num) {
	var left = num;
	return function() {
		left--;
		if(left <= 0) {
			return true;
		} else {
			return false;
		}
	};
}

function toKeys(arr) {
	var out = {};
	arr.forEach(function(key) {
		out[key] = "";
	});
	return out;
}

// Defaults
program
	.command('*')
	.action(function() {
		var files = [].slice.call(arguments),
			finished = countdown(files.length),
			out = toKeys(files);
		
		files.forEach(function(file) {
			fs.readFile(file, "utf8", function(err, contents) {
				var ret = [],
					md;
					
				out[file] = markdown(contents);
				if(finished()) {
					for(md in out) {
						ret.push(out[md]);
					}
					console.log(ret.join("\n\n"));
				}
			});
		});
	});
	
program.parse(process.argv);
	
